# Knowledge-Based Multiple Relations Modeling for Traffic Forecasting

**基于知识的多重关系模型用于交通预测**

## 摘要

交通预测是智能交通系统中的一个关键任务。近年来，已经提出了许多方法，并在建模高度非线性和复杂的时空模式以进行交通预测方面取得了显著进展。然而，==大多数方法都忽略了交通系统的特定内部和外部因素，如道路连接、每个地方周围的建筑物、换乘站等==。利用内部和外部因素的多样化知识的主要挑战是==如何表示和融合各种因素的影响==。很少有工作使用基于距离的邻接矩阵来表示因素，并使用逐元素乘法来融合它们，这可能会导致更糟糕的性能。在本文中，我们提出==利用知识图谱来表示交通系统因素==，并设计了一种新的神经网络来利用它们进行交通预测。首先，我们==从知识图谱的角度建模因素与交通条件之间的关系，并将它们表示为统一的三元组==。然后，我们==利用从知识表示模型中学到的嵌入和从图形结构中搜索的多跳路径来生成多跳路径特征==。接下来，我们介绍了一种==基于知识的多跳网络（KMHNet），它使用基于注意力的模块从多跳路径特征中学习相关性==。最后，为了评估所提出方法的性能，我们构建了两个包含交通条件子数据集和交通知识图谱的真实世界数据集。在两个数据集上的实验表明，我们提出的KMHNet优于八种知名方法。代码已公开可用，地址为：https://github.com/2448845600/KMHNet。



## 一、介绍

历史上，交通预测问题一直被当作单变量时间序列预测问题来处理，使用的方法如支持向量回归（SVR）[1]和长短时记忆网络（LSTM）[2]。这些方法仅考虑了交通数据中的时间依赖性。通过对实际场景的分析，大多数研究人员认为交通状况受当前和相邻交通节点早期交通状况的影响，并认识到空间相关性对交通预测也很重要。后续的工作使用深度学习方法来模拟这种复杂的时空相关性。==DCRNN[3]使用扩散卷积RNN对时间序列数据进行时空建模==。后来，Graph WaveNet[4]将图卷积网络（GCN）与卷积神经网络（CNN）相结合以模拟时空模式，而HGCN[5]则采用微观和宏观图来为GCN挖掘空间相关性。

ASTGNN[6]使用空间GCN替换了经典Transformer的前馈层，以实现动态和周期性的建模。时空建模在交通预测性能提升中起着重要作用。除了时间和空间相关性外，==各种外部因素也影响着现实世界的交通状况。因此，应将交通预测视为具有内部和外部因素的多变量时间序列预测问题==。如图1所示的一个例子，公交站点的乘客流量受到公交线路网络、兴趣点（POI）分布、换乘站、天气等因素的影响。位于不同区域但靠近办公楼的公交站点在高峰时段可能有类似的乘客需求。在预测算法中全面模拟所有内部和外部因素是一个吸引人的想法。然而，在探索这些因素对交通状况的影响时存在两个挑战。

 ==首先，由于各种因素的无结构特性，准确表示它们对交通状况的影响是一个挑战==。例如，兴趣点（POI）对客流和交通速度的影响通常与两个属性相关：POI与交通节点之间的距离以及POI的类别[7]。大多数工作[8]，[9]通过向量v来描述附近POI的分布，其中vi是交通节点附近类别为i的POI数量。然而，这种方法在现实世界场景中可能会导致相关信息的丢失。

==其次，各种因素的自适应融合以进行交通预测也是一个具有挑战性的问题==。这些因素可能同时作用于交通状况，而且它们的影响并非简单地叠加或抵消，这使得最终的影响变得复杂难明。以图2中的公交站C为例。它从学校获得稳定的客流，但部分客流会被其他周边站点，特别是地铁站在早高峰期间分流。POI和其他公交站点影响着需求的不同部分，最终使得整体结果难以预测。==一些方法[6]，[10]将天气、假期或人类流动性的独热编码与输入交通状况相结合==。GCN-SBULSTM[11]将旅行距离、人口流动和地铁站之间的连接定义为三个独立的图，并使用逐元素乘法操作来获得地铁乘客量预测的融合权重矩阵。==一些论文提出了自适应邻接矩阵[4]或随机初始化的空间嵌入[6]来学习隐藏的空间依赖关系，但这忽略了先验知识==。因此，整合交通网络与多个因素之间的复杂关系对于交通预测至关重要。

最近，知识图谱在知识表示和推理方面取得了进展，吸引了学术界和工业界的广泛关注[12]，[13]。经典的知识图谱通过一组三元组来组织事实，这些三元组包含头实体、尾实体和关系。头实体和尾实体可以是抽象概念或现实世界中的对象，而关系是实体之间的关系[14]。==在知识图谱中，将现实对象或抽象概念定义为三元组，使得融合多源原始数据变得容易==。受这项技术的启发，==我们从知识图谱的角度来建模不同因素对交通状况的影响，并将它们定义为（实体，关系，实体）的三元组==。例如，我们将学校对公交站客流的影响表示为（学校，附近，公交站），其中学校和公交站是实体，附近是关系。我们将交通系统视为一个知识图谱，其中交通节点、因素及其关系都被转化为三元组。

之后，我们==提出了一种基于知识图谱的多跳网络，名为KMHNet，用于知识图谱上的交通预测==。==首先，我们通过从知识表示模型学习得到的嵌入和从图结构中搜索得到的多跳路径来生成多跳路径特征。==

然后，我们提出了一个基于注意力的模块来学习节点之间的路径特征相关性。接下来，我们通过堆叠的图卷积层和时间卷积层来融合相关性和时间趋势。最后，我们利用全连接层来预测未来结果。为了评估KMHNet的性能，我们构建了SZBus和JNSpeed数据集，这两个数据集都包含来自现实世界的交通状况子数据集和交通知识图谱。这项工作的主要贡献如下：

• 我们将知识图谱应用于从多源原始数据中表达和融合交通系统中存在的各种因素，并且我们的知识图谱构建流程在两个数据集中都运行良好。

• 我们提出了一种新颖的基于知识的多跳网络KMHNet，可以从知识图谱中捕获节点相关性以进行交通预测。

• 我们构建了两个现实世界的数据集来评估我们的方法。

结果表明，与8个基线方法相比，我们的方法具有优势。源代码将在接受后公开提供。

## 二、相关工作

### A.交通预测

时空交通预测是智能交通系统（ITS）中的一个基本问题。早期的交通预测研究采用了统计方法，如历史平均（HA）和ARIMA模型[15]。随着深度学习的快速发展，大量研究将循环神经网络（RNN）[10]、[16]、[17]和卷积神经网络（CNN）[18]、[19]、[20]应用于建模交通网络中节点之间的时空相关性。==DCRNN[3]集成了图卷积网络（GCN）和门控循环单元（GRU）以提取时空相关性==。

越来越多的基于GCN（图卷积网络）的方法[21]、[22]、[23]被提出来以提高性能。Graph WaveNet[4]将GCN与CNN（卷积神经网络）相结合，用于空间模式和时间模式的识别。MTGNN[24]扩展了Graph WaveNet的组件，以学习更精确的空间依赖关系。

HGCN[5]为GCN构建了微观和宏观图来挖掘空间相关性。T-GCN[25]将GCN和GRU（门控循环单元）相结合，从交通数据中获取时空相关性，并实现准确且实时的交通预测。

STEP[26]集成了基于GCN的模型和预训练的Transformer，以捕获长期的空间-时间相关性。MRSTN[27]利用三种类型的关系来预测交通的流入和流出。参考[28]使用多图卷积网络来预测城市道路网络中的交通传播流。一些工作利用Transformer进行交通预测[6]、[29]、[30]。ASTGNN[6]改进了传统的Transformer，并将前馈层替换为空间GCN，以满足动态和周期性空间-时间相关性建模的需求。Lastjormer[30]结合了一个时空联合注意力机制，以模拟交通数据中的动态关系。最新的工作[31]提出了一种图稀疏化算法，该算法可以应用于自适应空间-时间图神经网络方法（如GWNet和AGCRN），以提高预测性能。

最近的工作KST-GCN[32]和K-ASTGRN[33]将交通系统的额外知识与知识图谱相结合，并将知识嵌入整合到GCN中。然而，这种方法丢弃了包含丰富信息的关系嵌入，并且无法建模在知识图谱中通过间接方式连接的交通节点之间的关系。

### B.知识图谱表示

知识图谱是一个由三元组（头实体，关系，尾实体）构成的网络，这些三元组包含语义信息和图形结构[34]。三元组由头实体和尾实体组成，它们可以代表具体的对象或抽象的概念。关系则表示实体之间的联系。

知识图谱嵌入，也被称为知识表示学习，是知识图谱领域的一个关键研究主题。它促进了各种知识获取任务和下游应用。已经提出了各种知识表示模型，它们被归类为组合型、翻译型和基于深度神经网络（DNN）的模型[35]。

RESCAL [36]、NTN [37] 和 HOLE [38] 是典型的基于组合的方法。RESCAL 和 NTN 都通过张量积捕获丰富的交互，但需要大量的参数来建模关系。为了克服这些缺点，HOLE 使用实体嵌入的循环相关性来创建更有效和可扩展的组合表示。相比之下，像 TransE、TransR 和 DistMult 这样的翻译模型提出了更简单的模型。

TransE [39] 在低维向量空间中表示实体和关系，并将头实体和尾实体之间的关系视为翻译操作。TransR [40] 为实体和关系分别设定了不同的空间，以解决统一空间对于两者来说都不足的问题。DistMult [41] 通过使用双线性对角模型来学习嵌入，并通过加权逐元素点积来表示关系。最近，已经提出了一些基于CNN、GNN和transformer的模型[42]、[43]、[44]用于知识表示学习。ConvE [45] 将实体和关系重新调整为2D矩阵。随后，它利用嵌入上的2D卷积和多层非线性特征来捕获实体和关系之间的相互作用。为了共享多任务知识，HypER [46] 通过超网络生成特定于关系的卷积滤波器。GIE [47] 使用多种几何形状来学习知识图谱中的可靠结构，并使用较少的参数来建模推理规则。



## 三、数据集

在本节中，我们介绍两个交通预测数据集：SZBus和JNSpeed，它们都包含一个交通状况子数据集和一个交通知识图谱。然后，我们将我们发布的数据集与其他流行的交通预测数据集进行比较。

![image-20240618145303375](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202406181453503.png)

### A. 交通状况子数据集

SZBus的交通状况子数据集由中国深圳巴士集团股份有限公司在2022年2月1日至2022年5月31日期间收集。原始IC卡数据包含1K个公交站和70M条IC卡刷卡记录。为了公交系统的规划和调度，我们更关注于具有大量客流的公交站。对公交IC卡数据的预处理如下：

首先，我们弃用一些数据缺失率高的公交站。其次，我们将剩余的公交IC卡数据按照15分钟的时间间隔划分为连续的时间步，并计算每个时间步内每个公交站的IC卡刷卡次数。城市公交系统中有许多换乘点。为了更准确地分析不同因素对客流的影响，本文中将拥有n条公交线路的换乘点视为n个独立的公交站。然后，我们计算平均刷卡频率f，公式为fi = 1/T ∑T t Nti，其中fi是第i个公交站的平均刷卡频率，T是时间间隔的数量，Nti是第i个公交站在第t个时间间隔内的IC卡刷卡次数。

最后，我们选择f值最高的公交站，如果选择了某个公交站，则选择该公交线的所有公交站。

经过上述四个预处理步骤后，我们获得了公交IC卡子数据集。

JNSpeed的交通状况子数据集由中国济南市中心区域的滴滴出行GAIA计划收集。该数据集包含路段的平均速度，采样频率为每10分钟一个样本。总样本数为52,286，时间范围从2020年1月1日至2020年12月30日。遵循HGCN[5]的设置，我们在实验中使用所有样本。

### B. 交通知识图谱

![image-20240618145906050](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202406181459121.png)

我们从多源原始数据中构建知识图谱以辅助交通预测。两个知识图谱的关系信息如表II所示，它抽象了城市交通系统中的共同因素，如POI、公交线路、道路网络等。

知识图谱的构建流程如下。以SZBus数据集为例。首先，我们从各种来源获取原始数据。公交线路结构数据展示在SZOpenData上，其中包括公交站与线路之间的归属关系、当前公交站的上游公交站和下游公交站。POI数据通过AMPA API收集。对于每个站点，我们查询半径1,000米内的POI。查询到的POI包含很多信息，我们使用了三个重要属性：坐标、ID和类别。有90,927个具有唯一ID的POI和17种类别。然后，我们从多源数据中定义实体和关系。对于公交线路结构数据，我们定义了两种实体，即线路和站点，以及五种关系：属于、附近、同位置、下游站点是和上游站点是。关系“附近”表示公交站之间的距离小于800米，而关系“同位置”表示头站和尾站服务于不同的公交线路但位于同一位置。对于POI数据，我们定义了另外两种实体，即POI和类别，以及两种关系，即接近和类别是。根据坐标，计算公交站和POI之间的距离，我们将距离小于800米视为“接近”。构建的交通知识图谱包含91,474个实体和615,605个关系。该知识图谱的一部分如图2所示。

与SZBus数据集类似，我们为JNSpeed数据集构建了一个知识图谱。我们从网站上获取了城市区域信息、道路网络结构、POI坐标和POI类别。然后，我们定义了五种实体和六种关系。总共有34,120个实体和402,618个关系。

### C.与其他数据集对比

现有的交通预测数据集，如METR-LA和PEMS，仅包含交通状况和邻接矩阵，这些不足以构建一个描述交通系统中全面和复杂关系的知识图谱。一些工作使用POI向量来增强这些数据集[9]，然而，POI向量只能粗略地表示交通节点周围的POI分布，缺乏每个POI的具体信息，甚至无法表达一些一般关系，比如一个POI靠近多个交通节点。因此，当前公共交通数据集中信息的缺乏阻碍了全面知识图谱的构建，并使得我们提出的KMHNet的训练和评估变得不可行。我们提出的SZBus和JNSpeed数据集都包含了交通状况子数据集和交通知识图谱，这些对于支持我们的研究来说是非常强大和必要的。



