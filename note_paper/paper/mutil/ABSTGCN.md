# Attention-based spatio-temporal graph convolutional network considering external factors for multi-step traffic flow prediction

基于注意力的时空图卷积网络，考虑外部因素以进行多步交通流预测

> 文章写的不错，可以的借鉴

## 摘要

交通流量预测是智能交通系统的重要组成部分。准确的多步交通流量预测在提高交通网络运营效率方面起着重要作用。由于交通流量数据具有复杂的时空相关性和非线性，现有的预测方法主要通过图卷积网络（GCN）和循环神经网络的组合来实现。

这种组合策略在交通预测任务中表现优异。然而，多步预测误差会随着预测步长的增加而累积。一些学者使用多个采样序列来实现更准确的预测结果。但这需要高配置的硬件条件和成倍增长的训练时间。考虑到交通流量的时空相关性和外部因素的影响，我们提出了一个考虑外部因素的基于注意力的时空图卷积网络（ABSTGCN-EF），用于多步交通流量预测。该模型将交通流量建模为在有向图上的扩散，并通过GCN提取交通流量的空间特征。我们==在编码器和解码器中添加了有意义的时间槽注意力，形成注意力编码器网络（AEN）来处理时间相关性==。注意力向量被用作一种竞争选择，以提取预测状态和历史状态之间的相关性。我们==考虑了三个外部因素（白天时段、工作日和交通事故标记）对交通流量预测任务的影响。==在两个公共数据集上的实验表明，考虑外部因素是有意义的。我们的ABSTGCN-EF模型的预测性能比最先进的基线高出了7.2%至8.7%。

## 一、介绍

交通预测是智能交通系统（ITS）的重要组成部分。由于交通流量具有高度非线性、时间依赖性、空间依赖性和不确定性[1]，道路交通流量预测是一个典型的时空数据预测问题。在交通研究中，通常选择速度、流量和密度等因素作为交通状况的指标。交通数据记录了分布在连续空间中的固定时间点和固定位置。显然，邻近位置和邻近时间戳的观察值并不是独立的，而是动态相关的。例如，在空间维度上，不同的位置对特定位置有不同的影响。甚至随着时间的推移，同一位置对该特定位置的影响也会有所不同。在时间维度上，不同时间的历史观测值对特定时间的交通状况有不同的影响。因此，探索非线性且复杂的交通时空数据并找到其固有的时空模式是一项非常困难的任务。进行准确的多步交通流量预测是一个非常具有挑战性的问题。

近年来，许多学者在这些问题上进行了大量研究。随着传感器技术的发展，大量不同类型的传感器设备被部署在交通网络上。这些传感器收集了大量带有地理信息的交通数据，为交通预测提供了良好的数据基础。

早期的时间序列预测模型分别研究了每个位置的数据序列。它们只能处理稳定且线性变化的时间序列，但无法准确处理复杂的交通情况。后来，提出了传统的机器学习方法来模拟交通序列的复杂性。然而，这些方法没有考虑道路网络的空间影响，并且需要大量专家经验[2]。现在，许多学者已经应用深度学习框架来处理交通流量预测问题。例如，循环神经网络（RNN）可以用于很好地处理时间序列。尽管已经取得了很大的成功，但时空相关性分析仍然是一个有待探索的挑战性话题。

为了解决上述问题，我们提出了一种考虑外部因素的基于注意力的时空图卷积网络（ABSTGCN-EF）。该模型更加关注与未来时间数据具有潜在相似性的历史状态数据。它综合考虑了交通流量数据的内在周期性和时空相关性。本文的主要贡献可以概括如下：

*(1) We model the traffic flow as diffusion on a digraph and extract the spatial characteristics of the traffic flow through a Graph Convolutional Network (GCN).

(2) We add meaningful Time-Slots attention to the encoder-decoder to form an Attention Encoder Net-work (AEN) to handle temporal correlation. The attention vector is used as a competitive choice to draw the correlation between the state to be predicted and the historical states.

(3) We have considered the impact of three external factors on the traffic flow prediction tasks, which are the time period, weekday mark, and traffic accident mark. Experiments show that these three external factors have a positive effect on traffic flow prediction. Experiments on two real data sets show that the proposed model outperforms state-of-the-art baselines.*

（1）我们将交通流量建模为在有向图上的扩散，并通过图卷积网络（GCN）提取交通流量的空间特征。

（2）我们在==编码器-解码器中添加有意义的时隙注意力以形成注意力编码网络（AEN）来处理时间相关性==。注意力向量被用作竞争性选择，以提取要预测的状态与历史状态之间的相关性。

（3）我们==考虑了三种外部因素对交通流量预测任务的影响，即时间段、工作日标记和交通事故标记。实验表明，这三种外部因素对交通流量预测具有积极影响==。在两个真实数据集上的实验表明，所提出的模型优于最先进的基线方法。



## 三、ABSTGCN-EF交通流量预测模型

交通流量具有时间动态性、空间相关性和不确定性的特点。为了解决这些特点，我们提出了考虑外部因素的基于注意力的时空图卷积网络（ABSTGCN-EF）框架。图1展示了ABSTGCN-EF的架构图。ABSTGCN-EF模型包含一个输入转换层、一个STGCN层和一个由全连接层组成的输出层。

![image-20240605212536520](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202406052125696.png)

该模型使用城市道路网络中道路传感器收集的时间-空间数据以及外部因素来预测未来交通流的平均速度等未来参数，并综合获得城市道路网络的时间-空间网络预测输出。输入转换层将==交通流属性数据（平均速度、交通量和车道占用率）==和外部因素数据进行嵌入和转换。外部因素使用了三种类型的数据，即时间段、工作日标记和交通事故。==STGCN层包含一个图卷积模块和一个时间维度的编码器-解码器结构==。输出层通过全连接层生成每个节点的预测结果。

ABSTGCN-EF模型的核心思想可以总结为以下两点。首先，将传感器数据同时视为图数据，通过连接节点和相邻节点来表示交通流的空间相关性，并利用图卷积网络来捕获交通流的空间相关性特征。其次，将同一节点在不同时刻的数据视为时间序列，==使用门控循环单元（GRU）和注意力机制来处理交通流的时间动态特性==。

STGCN层的结构如图2所示。

![image-20240605214123598](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202406052141722.png)

==时空图卷积模块（STGCN）由两部分组成，即GCN（图卷积网络）和AEN（注意力编码器网络）==。图卷积网络用于处理交通数据的空间依赖性，而注意力编码器网络用于捕获时间动态。通过研究交通流的内在特性，发现交通流的非线性和时空相关性特征会影响交通流预测结果，并且外部因素的相关影响也很明显。因此，为了在考虑数据获取便利性的同时有效应对这些交通流特性，本文提出的时空动态图卷积网络考虑了三个外部因素（时间、工作日标记和交通事故记录）的影响，并将这些因素的表示嵌入到输入转换层中。

对于多步预测任务，我们采用编码器-解码器结构来完成。==使用了定时采样（Scheduled Sampling）[22]来解决训练和测试过程中输入数据不一致的问题。它使用逆Sigmoid函数来调整选择真实观测值的概率α。以1-α的概率选择前一步的预测值。==

> 使用了定时采样（Scheduled Sampling）[22]来解决训练和测试过程中输入数据不一致的问题。它使用逆Sigmoid函数来调整选择真实观测值的概率α。以1-α的概率选择前一步的预测值。

### 3.1 考虑外部因素的交通流多步预测

多步交通流预测是通过历史测量对未来可能值的多重预测。观测值包括交通流量、速度、车道占用率等。m个历史时刻的观测值已经可用，n个未来时刻的多步预测值待获取。

(b_{v_{t+1}}; b_{v_{t+2}}; \ldots; b_{v_{t+n}} = \arg \max \log P(v_{t+1}; v_{t+2}; \ldots; v_{t+n} | v_{t_{-m+1}}; v_{t_{-m+2}}; \ldots; v_t; A; E))

其中，(v_t \in R^N) 是在时间t由N个道路传感器测量的历史观测值。(v_t) 是一个包含多个交通流数据的向量。E是交通路网上的传感器节点，A是由顶点组成的邻接矩阵。在这项工作中，我们在图上定义了交通网络。研究的重点是模拟交通时间序列与交通网络结构之间的时空相关性。

交通流是非线性和不确定的。它不仅受到内在交通流规律的影响，还因外部因素而发生剧烈变化。例如，交通事故和雨雪天气会导致车辆拥堵，从而大幅降低相关路段的车辆速度。因此，尽管交通流在总体趋势上是周期性的，但在不同的时间段内存在不同的趋势。除了交通流的特征参数外，还需要考虑其他因素。

本研究考虑了三个外部因素。

> 标签数据的数字化，为什么要小于一呢？

+ ==第一个因素是对应于交通流时间戳的时间段（TiD）。考虑这一因素可以更好地区分早晚高峰以及白天和夜间的交通流趋势。标记方法是将带时间戳的小时数加1再除以24，转换为标准化数据==。

> 在数据分析和机器学习中，特征标准化（Feature Normalization）或称为特征缩放（Feature Scaling）是一个常见的预处理步骤。标准化通常涉及将特征值转换为具有均值为0和标准差为1的分布，但在这段描述中，标准化是通过将时间戳转换为0到1之间的值来实现的。
>
> 为什么不直接使用1-24作为表示，而是选择标准化，有几个主要原因：
>
> 1. **模型性能**：许多机器学习算法在标准化后的特征上表现更好。这是因为标准化有助于确保每个特征在训练过程中都具有相似的权重。如果不进行标准化，具有较大值范围的特征可能会在模型训练中占据主导地位。
> 2. **梯度下降效率**：在训练神经网络等模型时，标准化可以加速梯度下降算法的收敛速度。因为标准化后，特征的尺度更加一致，使得梯度方向更加可靠。
> 3. **去除单位影响**：标准化去除了数据的单位或尺度，使得不同单位或尺度的特征可以直接进行比较和组合。在交通流预测的情况下，小时数（1-24）是一个序数特征，但标准化后，它仅表示一天中的相对时间，而不是具体的时钟时间。
> 4. **解释性**：虽然标准化后的值不如原始值直观，但标准化本身不会改变数据的相对顺序或趋势。因此，标准化后的值仍然可以很好地表示一天中的时间段（如早晚高峰、白天和夜间）。
> 5. **数值稳定性**：对于某些算法（如某些基于距离的算法或某些正则化方法），标准化可以避免由于数值范围过大而导致的数值不稳定性。
> 6. **泛化能力**：通过标准化，模型可以更容易地推广到不同的数据集，因为这些数据集可能具有不同的数值范围。
>
> 因此，虽然直接使用1-24也可以表示一天中的时间段，但标准化后的值在机器学习和数据分析中通常更为有用和有效。

+ 第二个因素是对应于交通流时间戳的星期几（DiW），用于区分交通流时间是否为工作日。目的是区分工作日和非工作日交通流的不同特征。
+ 第三个是交通事故标记，用于因交通事故导致的交通流突变。交通事故是一个具有时空特性的参数。当特定路段发生交通事故时，受影响的路段会随时间推移而发生变化。交通事故记录是通过交通性能检测系统收集的。根据事故类型的分类，高速公路上有五种事故记录，分别是无人员伤亡的交通事故、造成轻微伤害的交通事故、无详情的交通事故、造成死亡的交通事故和致命事故。我们基于事故持续时间的相似性，将5种记录数据整合为3种事故标签。对数据集中所有五种类型交通事故的持续时间进行了筛选，发现两种无人员伤亡的交通事故和造成轻微伤害的交通事故的持续时间分布相似，且记录的造成轻微伤害的交通事故数量非常少。因此，共同生成了事故标签1。记录的无详情的交通事故数量较多，且持续时间比轻微事故长，如事故标签2所示。造成死亡的交通事故和致命事故非常相似，被整合为事故标签3。计算得出，这三种类型的事故记录的平均持续时间分别为12.5分钟、19.7分钟和41.2分钟。因此，当这三个标签被标准化时，事故标签1表示为0.3，事故标签2表示为0.5，而事故标签3表示为1。

### 3.2 空间维度的图卷积模块

传统的卷积神经网络可以有效地提取数据的局部特征，但它们不适合一般的图结构。图卷积网络是卷积神经网络在图结构上的扩展。与使用图像2D卷积来获取交通模式和特征相比，图结构可以获得更原始和真实的空间属性。

将卷积神经网络推广到图结构数据的方法有两种。一种方法是扩展卷积的空间定义[23]。另一种是在谱域中使用图的傅里叶变换进行操作[19]。

交通流的扩散过程可以看作是行驶车辆的随机游走。如图3所示，有两条东西双向道路和两条南北单向道路。这四条道路上分布着八个传感器节点，节点的连通性与道路的并行性一致。

### 3.3 时间维度模块

我们使用注意力编码器网络（AEN）作为时间维度建模的基本结构，以捕获时间序列特征并获得多步输出。==该方法由两个具有独立参数的相互连接的GRU模块组成==[25]。如图2所示，我们首先通过图卷积网络从交通流数据中提取空间特征。然后，将获得的连续时间特征序列用作时间维度建模的输入。图2中蓝色虚线框中的AEN模块由两个具有独立参数的GRU网络组成。编码器模块在左侧，解码器模块在右侧。编码器对输入时间序列进行编码。编码器的最后一分钟状态将初始化解码器模块。解码器根据上下文向量以时间步长生成预测输出。

一个潜在的问题是，编码器-解码器模型需要将源句子的上下文信息压缩成一个固定长度的向量。这使得模型难以处理长序列，尤其是那些比训练数据中的特征序列更长的序列。编码器-解码器模型可能难以掌握交通流中更长的周期性特征，如每周的规律性。Cho等人[26]表明，随着输入句子长度的增加，基本编码器-解码器的性能确实会迅速下降。