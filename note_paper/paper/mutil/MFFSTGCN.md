# A Deep Learning Approach for Long-Term Traffic Flow Prediction With Multifactor Fusion Using Spatiotemporal Graph Convolutional Network

使用时空图卷积网络的多因素融合长期交通流量预测的深度学习方法

## 摘要

作为智能交通系统（ITSs）领域的一个重要研究主题，近年来，使用深度学习方法进行交通流量预测已经引起了广泛关注。

然而，许多现有研究主要集中在短期交通流量预测上，并且未能考虑外部因素的影响。有效的长期交通流量预测已成为一个具有挑战性的问题。为了解决这些挑战，本文提出了一种基于时空图卷积网络的深度学习方法，用于多因素融合的长期交通流量预测。在提出的方法中，我们的==创新点在于引入了一个属性特征单元（AF-unit），以将外部因素融合到时空图卷积网络中==。该方法包括（1）使用高斯相似函数构建加权邻接矩阵；（2）组装一个特征矩阵以存储时间序列交通流量；（3）构建一个由外部因素（包括温度、能见度和天气条件）组成的外部属性矩阵；（4）基于深度学习架构（即T-GCN）构建时空图卷积网络。

实验结果表明：（1）与基准模型相比，考虑时空依赖性的我们的方法具有更好的预测能力；（2）气象因素的融合可以降低交通预测的误差；（3）我们的方法在长期交通流量预测中具有较高的准确性和稳定性。



## 一、介绍

在上述研究中，交通信息，包括速度、流量、密度等，被选择用来表示当前的交通状态。根据预测的时间长度，交通流量预测可以分为短期、中期和长期预测[4]，[35]。在大多数情况下，==15分钟或更短时间的预测被认为是短期的==。==中期预测通常在30分钟到1小时之间==，而==长期预测则表示超过1小时的时间范围==[11]。目前，大多数研究都集中在短期预测上，这主要用于实时交通控制。在发生交通事故的情况下，短期预测模型应该准确测量事故后时间的交通流量。然而，长期预测可以帮助管理者做出早期决策和制定整体安排，这将导致更好的交通管理和更高效的服务。除了为提高有限的交通管理资源效率提供参考外，长期预测还可以帮助旅行者通过提前规划来避免拥堵。由于长期预测对误差传播的敏感性，它比短期预测更具挑战性[36]，[37]。

为了为长期交通流量提供有效的预测能力，本文提出了一种基于时空图卷积网络的多因素融合长期交通流量预测的新方法。==该方法的基本思想是考虑交通流量的时空依赖性和外部因素==。

首先，为了获得自动交通记录器（ATRs）的空间相关性，我们通过成对连接ATRs来建立一个全连接的监测图（FCMN）[38]，并计算每条边的权重（即ATRs之间的接近程度）以获得加权邻接矩阵。

接下来，我们的创新之处在于通过==引入一个属性特征单元（AF-unit）来考虑多个外部因素（即气象特征）对长期交通流量变化的影响，以捕捉时间特征==，并通过AF-unit进一步融合交通流量数据和天气数据。

最后，我们使用深度学习方法来预测长期交通流量。对于空间数据，我们使用最先进的GCN模型；对于时间数据，我们使用GRU模型。在本文中，GCN和GRU被结合起来，构建了时空图卷积网络。

本文的主要贡献可以总结如下：

• 我们利用T-GCN，这是一种结合了==GCN和GRU==的深度学习架构，来确定交通流的时空特性。基于构建的称为FCMN的图结构，GCN可以捕获空间相关性，而GRU可以分析时间序列数据以进行交通流量预测。

• 我们==考虑了外部因素对交通流量变化的影响，如温度、能见度和天气条件==。在本文中，所提出的新方法被应用于长期交通流量预测这一具有挑战性的任务。

• 我们使用真实世界的数据集来评估该方法。根据实验结果，所提出的方法在预测方面比基线方法表现更好，这表明在长期交通流量预测中考虑时空依赖性和融合外部因素的有效性。



## 三、方法论

### A. 总览

本文提出了一种基于时空图卷积网络的多因素融合长期交通流量预测的深度学习方法；参见图2中的工作流程。第一步描述了数据准备。需要获取并预处理交通流量数据和气象数据。第二步解释了数据处理。在处理空间和时间依赖数据后，我们进一步将交通流量预测问题转化为学习映射函数。

在第三步中，我们利用一个名为T-GCN的深度学习模型来构建时空图卷积网络。==通过结合GCN处理空间相关性和GRU处理时间相关性==，T-GCN模型成为了一个多功能的工具。此外，==我们还考虑了外部因素对交通流量变化的影响，包括温度、能见度和天气条件，并使用AF-unit来捕获时间特征==。最后，我们总结了所提出方法的实现过程。

![image-20240606111701102](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202406061117249.png)

### B. 第一步：数据准备

#### 1. 数据采集

交通流量数据集通常通过各种检测设备收集。目前，常用的自动收集技术分为静态检测和动态检测[13]。具体来说，静态检测方法采用固定检测器进行采集，如环形检测器、红外探测器、超声波探测器、雷达探测器和光电探测器。动态检测方法则基于位置变化的车辆来获取交通信息，所使用的设备包括车辆上配备的全球定位系统（GPS）、自动车辆识别（AVI）蓝牙、远程交通微波传感器（RTMS）[41]、[42]以及无线通信。通常，从检测系统获取的交通流量信息主要包括交通量、流量率、速度和占有率。

同样地，气象数据集是通过气象站的监测系统收集的。所谓的自动气象站（AW）是指集成了电子、智能仪器、传感器和无线通信技术的气象观测设备，用于检测、记录和传输温度、能见度、相对湿度、降水量、气压、风速等信息[43]。

#### 2. 数据预处理

不同的监测系统被用来收集原始数据集。不可避免地，会出现设备故障和通信系统故障，这将导致缺失值、异常值和不相关值[44]。

为了优化收集到的数据质量和计算的有效性，对原始数据集进行预处理是交通流量预测中的一个必要步骤。预处理的方法主要包括量化[1]、数据重采样[45]、数据补全[46]和归一化[38]。

在本文中，数据预处理包括交通流量数据的预处理和气象数据的预处理两部分。为了保持时间和空间的一致性，这两个过程同时执行。具体来说，我们将数据预处理过程分为以下四个步骤：

+ 数据检查：在数据集中现有的问题（例如，无关的值、无法量化的参数、缺失值和异常值）得到妥善处理之前，首先需要检测这些问题。在本文中，我们选择了三个气象因素，包括温度、能见度和天气条件，以考虑外部因素对交通流量变化的影响；因此，移除与研究不相关的值至关重要。此外，我们使用数据描述性工具和算法，通过总结统计数据（包括确定缺失值和异常值）来检查数据的质量[47]。

+ 数据重采样：例如，我们收集的交通流量数据和气象数据来自不同类型的监测系统。为了保持时间的一致性，我们根据交通流量数据的间隔对气象数据进行重采样，即去除冗余的气象数据，仅提取与交通流量采样时间点对应的数据。为了保持空间的一致性，我们以交通流量探测器的位置为基准，选择最接近的气象监测站。

+ 数据优化：非数值记录（如天气状况）的参数很难用来计算天气数据与交通流量数据之间的相关性。因此，在==初步处理中，我们使用独热编码[1]==。我们将六种天气状况转换为数值，并将它们映射为1、2、3、4、5和6。然后，通过独热编码将数组转换为一个n×6维的矩阵。

  最后，天气状况列被成功地替换为6列的独热编码（见表I）。

  此外，==原始数据集包含许多缺失值，我们根据缺失数据的解释方式，使用不同的方法来填充数据集。例如，可以根据前一个或后一个数据将天气状况类型估算为6==。

  在==另一种情况下，使用线性插值来估算温度数据会更合理==[10]。

+ 数据归一化：不同的特征往往具有不同的维度和单位，如果维度之间的差异很大，模型就难以收敛。==数据的归一化不仅可以缩短训练时间，还可以提高模型计算的准确性。有许多常见的归一化方法，如z-score归一化、min-max归一化、softmax归一化。本文使用min-max归一化方法将数据归一化到[0, 1]的区间内==。

> 数据预处理：
>
> 1. 缺失值插补（Missing Value Imputation）
> 2. 独热编码 (one-hot coding)
> 3. 数据归一化（Data Normalization）
>
> > ### Min-Max 归一化（Min-Max Normalization）
> >
> > **Min-Max 归一化**是一种将数据按比例缩放到一个固定范围的技术。它的公式如下：
> >
> > ![image-20241202101621307](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202412021016457.png)

### C. 第二步：数据处理

交通流量预测的目标是指基于交通流量数据的时间序列来预测未来的状态，即利用当前时间t的数据来预测下一个时间t+Δt的交通流量。根据预测时间的长短，交通流量预测可以分为短期、中期和长期预测[48]。目前，大量模型都针对短期交通预测，而有效的长期交通预测已成为一个具有挑战性的问题。根据美国联邦公路管理局的数据，23%的交通事故是由于恶劣的天气条件造成的。各种研究表明，交通流量与天气条件之间存在很强的关系，长期交通流量的变化受到天气的影响。因此，研究天气对交通预测的影响非常重要[49]。

本文的目的是根据路段的历史交通信息来研究其时间和空间特征以及长期依赖性，并将这些信息与长期序列预测中的外部影响（例如温度、能见度和天气条件）相结合。在这里，交通信息代表了一般概念，如交通量、速度、密度等。本文的实验以交通量为例。

#### 1. 空间依赖数据的处理

空间依赖数据的处理：为了表示高速公路上下游自动交通记录器（ATR）之间的空间相关性，我们使用加权无向完全连通图G = (V, E, W)来描述道路网络的拓扑结构，并将其称为功能连接矩阵网络（FCMN）[31]。在这里，我们将每个路段视为一个节点v，V = {v1, v2,...,vN }代表路段的集合，其中n是节点的数量。这些节点成对连接以形成一组边E，E = n(n − 1)/2。加权邻接矩阵W用于表示节点之间的邻近性。图3展示了在监控系统中构建一个FCMN的示例。

在获得的交通数据中，明尼苏达州州际公路I-94上的ATR之间的最长地理距离可以达到180多公里。此外，由于检测器的位置不同，图4中显示的交通流量测量值明显不同。在市中心，S301和S342的交通流量每小时超过6000辆，而S175和S200位于郊区，那里的交通流量明显较低。考虑到FCMN中两点之间的空间相关性，我们基于高斯相似性通过等式（5）计算加权邻接矩阵。

![image-20240606131054504](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202406061310602.png)

 其中，dist(i, j) 表示监测点 si 和 sj 之间的距离，而邻域的宽度由距离的标准差 σ 控制 [50]。

通过等式 (6)，我们可以计算加权邻接矩阵。

两个点之间的相关性越大，权重计算的结果也越大。

![image-20240606131845437](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202406061318511.png)

#### 2. 时间依赖数据的处理

我们构建了交通特征矩阵X和外部属性矩阵K来表示交通流量的时间依赖性。

交通特征矩阵X可以表示为X ∈ RN×P，其中P表示节点时间序列特征的数量（即历史时间序列的长度）。节点属性特征可以是交通量、速度、密度等交通信息。在本文中，我们以交通量为例，X ∈ RN×i 表示每个ATR在时间i的交通量。

外部属性矩阵K由影响交通状况的外部因素组成。在本文中，三个气象因素被视为交通量预测中的增强属性，包括==温度、能见度和天气状况==。$K_{j} = \{j^{1},j^{2},...,j^{t}\}$ 表示类型j的一组外部信息，而 $j_{i}^{t}$ 是第 i 个ATR在时间 t 的第 j 个外部信息。

因此，在定义了FCMN（功能连接矩阵网络）、交通特征矩阵X和外部属性矩阵K之后，交通预测问题就转化为学习映射函数f的问题，该函数可以计算未来T个时刻的交通信息。

### D. 第三步：数据建模

#### 1. 时空图卷积网络的构建

在城市道路网络中，交通流具有很强的时空依赖性。对于时间依赖性，交通流的变化可能遵循一定的规律，下一个时间点的交通流值可以被视为当前时间点的延续。对于空间依赖性，交通流受到上下游交通状态的影响，也可能受到附近相连路段的影响。因此，对交通流预测的研究应该同时从空间和时间两个维度进行分析。

城市交通网络由相互连接的道路组成，交通网络上的任何地点都具有空间可达性。不幸的是，基于卷积神经网络（CNNs）的方法只能从欧几里得空间中提取特征，仅适用于规则网络。图卷积网络（GCNs）将传统卷积扩展到不规则图结构，最近引起了广泛关注。GCNs可以直接使用图结构信息来提取空间特征，并处理不规则图以完成交通预测任务[51]。因此，交通网络被建模为图，而不是网格或段。

此外，交通流还具有时间相关性，可能受到路况、交通事故、天气变化、假期和其他因素的影响。为了捕获交通流的时间依赖性，已经提出了许多处理时间序列数据的神经网络模型，如RNN、LSTM和GRU。由于存在梯度消失和梯度爆炸的问题，传统的RNN无法解决长期交通流预测的问题。1997年，Hochreiter[52]提出了LSTM模型来解决这个问题。

LSTM层有四个主要组成部分：输入门、遗忘门、输出门和自连接记忆单元。

Cho等人[53]提出的GRU模型简化了LSTM模型的结构。通过将门的数量从三个减少到两个，GRU大大提高了操作效率。虽然GRU和LSTM方法都基于相似的原理，但由于其简单性和更快的训练速度，研究人员更倾向于GRU。

本文在第二节中详细介绍了GCN和GRU的理论背景。在本文中，==GCN和GRU被结合起来构建了一个时空图卷积网络==。GCN用于捕获交通流的空间依赖性，而GRU在输入时间序列数据后可以对交通流进行时间序列预测。

#### 2. 外部因素的融合

![image-20240628202752893](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202406282027274.png)

> 图5. 天气条件对交通流量的影响示意图。该图显示交通流量明显受到天气的影响。首先，晴天的交通流量明显高于雪天的交通流量。此外，晴天和雪天的交通流量高峰时段也不同。晴天有两个高峰时段，分别在早上7点和下午4点。然而，雪天的高峰时段是在下午2点。

![image-20240628203816544](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202406282038621.png)

> 一张关于能见度对交通流量影响的示意图。交通流量受到能见度的影响。雪天的能见度低于晴天，这导致雪天的交通流量较低。

一般而言，气象条件是影响人们出行选择的主要外部因素，极端天气会严重限制出行并影响道路交通。不同的气象因素和天气强度对交通流量的变化有不同的影响[54]。例如，在暴雨的影响下，交通流量会相比正常天气显示出下降的变化，如图5所示。此外，图6显示了能见度降低对交通流量的影响。因此，将气象因素纳入交通预测模型有助于减少不准确性[29]，[55]。

本文选择了具有代表性的气象参数，包括==温度（T）、能见度（V）和天气状况（C）==，并将它们作为外部因素融合在一起来研究气象因素对交通流量的影响。第五节给出了详细的解释。值得注意的是，==天气状况通过独热编码（one-hot coding）处理为数值参数==。

此外，Zhu等人[49]将外部因素视为道路网络中路段的静态和动态属性，并设计了一个属性增强单元来获取更多的交通特征。然而，他们仅对一个动态气象因素进行了实验。在本文中，我们选择了三个动态气象因素：温度（T）、能见度（V）和天气状况（C）。因此，我们开发了一种名为属性特征单元（AF-unit）的改进方法，以捕获动态气象特征。

然后，一个由交通特征矩阵X和外部属性矩阵K={T, V, C}派生的融合矩阵被输入到AF-unit中。

上述提到的三个气象因素随时间变化，表明它们是动态属性。

具体来说，鉴于交通状况受到动态因素随时间累积效应的影响，我们为每个动态属性子矩阵$K_i$选择Kt−m,t i = [Kt−m i , Kt−m+1 i ,..., Kt i ]，其中i代表不同类型的外部因素，Kt−m,t i是从时间t-m到t的i个外部因素的动态信息的集合。我们进一步通过AF-单元将交通流数据和天气数据融合，得到用等式(8)表示的属性增强矩阵Et。

![image-20240606195300774](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202406061953903.png)

#### 3. 方法实现过程

为了捕捉长期交通流和外部因素的特征，我们构建了时空关联图卷积网络，并提出了一种整合外部因素的长期交通流预测的深度学习方法。所提出方法的实施过程如图7所示，可以分为三个组成部分：时空依赖性、外部因素和交通预测。

首先，我们需要从原始数据中提取时空依赖性特征。对于空间依赖性，我们构建了FCMN网络，并获得了加权邻接矩阵Aw。对于时间依赖性，我们提取原始交通流的时间序列数据，并建立交通特征矩阵X。

其次，我们进一步融合了交通流数据和三个外部动态属性，包括温度、能见度和天气条件。使用AF单元来获取属性增强矩阵Et，作为计算模型（T-GCN）的输入。

最后，我们利用T-GCN进行长期交通预测，该模型结合了GCN（图卷积网络）和GRU（门控循环单元）。GCN可以在FCMN中捕获空间相关性。将输入的交通流序列Xt嵌入到空间特征中，以获得新的交通流序列X˜t。关于T-GCN的更多详细信息在第二节中提供。



## 四、实验

在本节中，我们将应用所提出的深度学习方法来对明尼苏达州收集的真实数据集进行交通流预测，并从三个方面分析结果：（1）不同预测时间范围的比较，（2）与基准方法的比较，以及（3）消融实验。

### A. 数据源

在我们的实验中，所使用的交通数据集来自明尼苏达州交通部，气象数据集则来自国家海洋和大气管理局（NOAA）。我们首先限制了研究空间和时间范围；然后选择感兴趣的数据，以确保交通流量和气象数据的时空一致性。

我们从交通流量和气象数据中提取了以下关键内容：

• MN 交通量：每小时向西行进的交通量。

• ==每小时天空状况：每小时的天气情况。记录了六种天气状况，包括晴空（CLR）、少云（FEW）、多云（SCT）、破碎云（BKN）、阴天（OVC）和遮挡天空（VV）==。

• 每小时能见度：每小时的大气能见度。

• 每小时温度：每小时的大气温度。

所获取的数据集可用性如下：https://www.dot.state.mn.us/ 和 https://www.ncei.noaa.gov/。在交通流量数据集中，编号为175、200、301、342和354的五个自动交通记录器（ATRs）从2017年1月1日至2017年12月31日每小时监测交通量。

在气象数据集中，从美国国家海洋和大气管理局（NOAA）的气候数据中选择了五个离I-94高速公路上五个ATRs最近的气象站，其WBAN编号分别为：00238、04945、94960、14927和00180。

这五个气象站从2017年1月1日至2017年12月31日每小时记录了气象数据，包括每小时的气压设置、每小时的温度、每小时的相对湿度、每小时的风速、每小时的能见度、每小时的天空状况等。特别地，==除了每小时的天空状况是非数值参数（即晴空、少云、多云、破碎云、阴天和遮挡天空）外，其余都记录为可量化的数据==。

图8显示了气象站与ATRs之间的位置关系。



### D. 数据处理

在执行数据准备和处理后，我们获得了两组时空数据集，包括交通流量数据和气象数据。使用FCMN构建方法，我们连接了五个ATR（自动交通记录仪）点，并获得了5x5的权重矩阵Aw(5,5)，用于图形化表示每个ATR点之间的空间关系。对于时间数据，我们同时处理了交通流量数据和气象数据，以确保时间一致性。首先，我们从2017年1月1日到12月31日==每小时收集数据==。

然后，我们构建了一个5x8760的特征矩阵X，它表示每个ATR随时间变化的交通量。

每一行代表一个ATR；每一列代表与监测频率对应的交通量。

**我们还对这两个数据集进行了数据清洗，包括数据检查、数据重采样、数据优化和数据归一化。值得注意的是，对于交通量和温度参数，我们使用了线性插值方法，而对于能见度和天气条件，我们使用了补充前一个或后一个值的方法。**

此外，我们通过引入AF单元来捕捉时间特征，并考虑气象因素（即温度、能见度和天气条件）对长期交通流量变化的影响，进一步通过AF单元融合交通流量数据和天气数据。我们还严格进行了消融实验，以检查各种外部因素对交通流量的影响。



### F. 实验结果

#### 1.所提方法在不同预测时间范围下的预测性能：

为了评估所提方法在长期交通流量预测中的效率，我们在不同的预测时间范围（1小时、2小时、3小时）下测试了其性能，并将其与T-GCN模型进行了比较。结果列于表III。
根据图9，我们的方法在所有三个预测时间范围上都优于T-GCN。具体而言，在1小时的预测时间范围下，我们的均方根误差（RMSE）比T-GCN低约0.55%，平均绝对误差（MAE）比T-GCN低约2.17%。在2小时的预测时间范围下，我们的RMSE比T-GCN低约2.33%，MAE比T-GCN低约3.03%。在3小时的预测时间范围下，我们的RMSE比T-GCN低约5.82%，MAE比T-GCN低约8.28%。此外，随着预测时间范围的增加，误差仅略有增加，精度略有下降，表明该方法具有一定的稳定性。
上述分析结果表明，我们的方法能够在不同的时间范围内保持良好的性能，并且在长期预测中变得越来越有效。在后续实验中，我们选择了更具挑战性的3小时长期预测时间范围，以进一步分析实验结果，包括与基线模型的比较和消融实验。

#### 2.与基线模型的预测结果比较

此外，为了证明我们所提方法的优越性和有效性，并确保实验结果的清晰性，我们将其与多种广泛使用的基线模型进行了比较，并将结果列在表IV中。

实验结果表明，使用深度学习方法（即我们的方法、T-GCN、GRU和LSTM）的预测精度显著高于其他时间序列区域模型（即HA、ARIMA和SVR）。

与HA、ARIMA和SVR模型相比，我们的RMSE分别降低了约81.02%、76.62%和55.05%，MAE分别降低了约84.51%、82.78%和52.80%。此外，通过其他指标（即准确率、R2和var）评估的性能也得到了显著提高。

与仅关注时间关系的LSTM和GRU相比，我们的RMSE分别降低了约37.07%和37.35%，MAE分别降低了约50.21%和50.47%。结果表明，我们考虑时空依赖性的方法具有更好的预测能力。

与考虑时空关系的ASTGCN和T-GCN相比，我们的RMSE分别降低了约43.27%和5.82%，MAE分别降低了约41.42%和8.28%。与AGCRN相比，我们的MAE增加了13.95%，但RMSE降低了约1.75%，并且我们模型的其他三个指标（包括准确率、R2和var）均高于AGCRN。结果表明，在考虑外部影响方面，我们考虑外部因素的方法优于ASTGCN、T-GCN和AGCRN模型。

上述比较结果验证了我们所提方法的有效性。该方法能够很好地捕获交通流的时空特征以及外部因素的影响，显示出良好的长期预测能力。

#### 3.消融实验

为了验证各种外部因素对交通流量的影响，我们严格进行了消融实验。实验分为7组：仅添加温度、仅添加能见度、仅添加天气状况、温度+能见度、温度+天气状况、能见度+天气状况以及温度+能见度+天气状况。结果列于表V，并在图10中进行了可视化。

在下面的描述中，我们使用T-GCN作为比较的基线。在实验（a）、（b）和（c）中，当仅添加一个气象因素时，（a）和（b）的RMSE分别降低了4.93%和2.88%；（a）和（b）的MAE分别降低了7.78%和6.24%。天气状况对交通量的影响最大，而温度的影响不显著。

在添加了两个气象因素后（即实验（d）、（e）、（f）），（d）、（e）和（f）的RMSE分别降低了2.86%、6.24%和1.14%；（d）、（e）和（f）的MAE分别降低了7.71%、8.29%和3.11%。这项研究表明，天气状况和温度对交通流量的影响最大。通过添加三个气象因素（即实验（g）），（g）的RMSE降低了5.82%，MAE降低了8.28%。所有这三个气象因素对交通流量都有显著影响。

分析结果表明，通过融合外部因素，我们的方法性能优于T-GCN模型。此外，这三个气象因素与交通流量的变化有关，其中天气状况和温度的影响最大。总的来说，将气象因素添加到交通预测模型中有助于减少不准确性。