## Multi-Source Information Fusion Graph Convolution Network for traffic flow prediction

用于交通流量预测的多源信息融合图卷积网络

*广西大学机械工程学院*

*Expert Systems With Applications*

## 摘要

作为智能交通系统领域的一项基础技术，交通流量预测有着广泛的应用。利用图卷积网络（GCN）模型在捕捉交通数据中复杂的时空依赖关系方面表现突出，这使得预测精度得到了显著提高。然而，现有的大多数图构建方法都忽视了天气、交通速度等辅助信息对道路拓扑结构的联合影响。此外，在粗时间分辨率下对时间序列内部相互作用的研究仍未得到充分探索，导致长期预测性能不尽如人意。 在本研究中，我们提出了一个全新的框架，即多源信息融合图卷积网络（MIFGCN），用于进行时空交通流量预测。我们的==关键创新在于创建了一个动态图，该图整合了天气、交通速度和全局空间信息，能有效模拟道路网络中细微辅助信息所导致的显著交通波动==。 同时，它还能捕捉节点之间随时间演变的隐藏邻接关系。此外，通过与基于注意力的时间交互模块相结合，MIFGCN能够在粗时间分辨率下学习多尺度的时间相关性，从而增强长期预测的能力。在四个真实世界交通数据集上进行的实验表明，MIFGCN的性能优于各种最先进的基准模型，尤其在PeMS08数据集上实现了平均10.50%的性能提升。

## 一、介绍

城市化的快速发展给城市发展带来了重大挑战，尤其是在实现高效交通方面。 为应对这一挑战，智能交通系统（ITS）得到了广泛应用，旨在缓解交通拥堵并提高出行效率（金、荣等人，2022年）。 交通预测已成为智能交通系统内一个突出的研究焦点，涉及多个领域。利用历史数据进行准确的交通预测，在优化城市规划以及支持各类日常应用方面起着至关重要的作用（方、唐等人，2021年）。道路网络内的时空相关性是直接影响交通流量预测精度的关键因素（叶、方、孙、张、向，2022年）。各种深度学习模型，如用于处理空间依赖关系的卷积神经网络（CNN）和用于处理时间动态的循环神经网络（RNN），已成为应对这些挑战的有效解决方案（姚等人，2018年；尹等人，2022年；张、郑、齐、李、易，2016年）。最近，图神经网络（GNN）大受欢迎，在对时空交通数据进行建模和预测方面表现出卓越的性能。图神经网络的有效性在于它能够捕捉道路网络中固有的复杂空间相关性。这种能力有助于理解不同地点和时间段之间的复杂关系、依赖关系以及相互作用，最终提高交通预测任务的准确性（金、李、张、王和黄，2022年）（见图1）。

然而，现有的大多数基于图神经网络（GNN）的交通流量预测研究都忽视了间接影响空间拓扑结构的辅助信息，比如天气状况、交通信号灯以及交通速度（志坚、大彪、夏，2020年）。例如，一场暴风雪会大幅降低交通速度，进而改变一个区域内的交通流动力学。鉴于道路节点的时空属性具有高度动态性，将辅助数据与道路网络进行整合就显得至关重要。这种整合能在不同的时间节点提供情境性的见解，增强模型对复杂交通场景的适应能力。因此，==构建一个融合多种信息源的动态图==（这方面的研究较少）有助于灵活捕捉交通流量的时间演变过程。 此外，通过下采样生成两个时间子序列已被证明能够保留相似的时间趋势和季节性成分。通过交互式学习可以探索更丰富的多分辨率特征。然而，不同时间步长的节点之间的相关性并非均匀分布，现有的交互式学习过程无法自适应地捕捉到这种情况。

为解决上述问题，本文提出了一种用于交通流量预测的多源信息融合图卷积网络（MIFGCN）。 我们==开发了一个动态图模块，用于整合两个预先定义的邻接矩阵和辅助信息，以动态捕捉道路网络随时间演变的特征，从而加强对复杂时空相关性的建模==。我们利用动态时间规整（Dynamic Time Warping，DTW）算法构建一个包含全球空间相关性的邻接矩阵。此外，我们==将天气和车速作为辅助信息==，以弥补仅使用交通流量数据在时空方面的局限性。 而且，我们==引入了一个创新的基于注意力的交互式学习模块，以有效提取交通流量的多分辨率（multi-resolution）时间相关性==。该模块包含下采样、多次时间卷积以及基于注意力的交互学习。它有助于提取和建模不同尺度下的动态时间关系，既能捕捉短期波动，又能捕捉长期依赖关系。 此外，我们==利用具有不同时间粒度的数据来探索跨维度的时间趋势和周期性==。这种方法能够带来更好的泛化能力和更稳健的预测结果，尤其在各种因素导致的异常交通状况下更是如此。多模态数据的整合有望在交通流量预测领域取得重大进展。 综上所述，本文的主要贡献可总结如下：

+ 我们提出了一个名为MIFGCN的交通流量预测框架。 该框架利用基于注意力的交互式学习来==提取多尺度的时间相关性==。此外，它==采用扩散图卷积来整合来自多个源的信息，有效地对道路网络的隐含影响进行建模并捕捉全局空间依赖性==。 
+ 我们开发了一个能够==基于注意力机制整合多源信息的动态图模块==。该模块整合了来自不同特征维度的辅助信息以了解道路网络的潜在相互作用，从而提高交通流量预测的稳健性和准确性。 
+ 我们在四个真实世界的交通数据集上进行了实验。结果表明，相较于最先进的基准模型，有了显著的改进。

## 二、相关工作

### 2.1GCN

图卷积网络（GCN）模型是专门为分析非欧几里得数据而设计的。与在规则网格上运行的标准卷积神经网络不同，GCN可以处理更一般化的图，并适应其结构。GCN的主要特点是在计算节点的表示时，通过聚合来自该节点邻居的特征信息来利用图结构。这使得模型能够有效地整合图结构和来自相邻节点的特征信息。早期的研究通常采用基于谱的图卷积网络，该网络利用傅里叶变换将拓扑图结构从空间域转换到谱域，并利用邻接矩阵和图拉普拉斯矩阵的特征分解进行图分析（布鲁纳、扎雷姆巴、斯拉姆和勒昆，2013年；德费拉尔、布雷松和万德根斯，2016年）。 为了降低计算复杂度并提高鲁棒性，现代方法主要采用基于空间的图卷积方法。GraphSAGE（汉密尔顿、英和莱斯科维奇，2017年）采用了不同的方法，它通过采样和聚合技术从局部节点邻域收集特征信息，便于为初始训练数据中不存在的节点创建表示。GAT（韦利科维奇等人，2017年）利用掩码自注意力层从相邻节点聚合加权特征，解决了传统基于谱的GCN在计算和空间局部性方面的局限性。 





## 三、预备知识

### 3.1 道路网络

探索道路连接之间的物理相互作用被证明是捕捉局部空间关系的一种有价值的方法。 然而，具有共同属性（如道路标识、限速和路口设计等）的道路，即使没有直接的物理连接，也可能呈现出相似的交通流量模式。因此，我们引入了两种不同的图来描绘道路网络并涵盖更广泛的空间信息：空间连通性图，记为$G_{sp} = (V, E_{sp}, A_{sp})$；以及时间相似性图，记为$G_{te} = (V, E_{te}, A_{te})$。其中，$V$是由$N$个节点组成的集合$（\vert V\vert = N）$，$E_{sp}$和$E_{te}$是边的集合。$A_{sp} \in R^{N\times N}$和$A_{te} \in R^{N\times N}$分别是这两个图的邻接矩阵。

#### 3.1.1 时间图

==动态时间规整（DTW）算法==能够对不同时间序列中的相似片段进行非线性对齐，即便这些序列的变化速度不同或存在细微偏差时也能如此。在对交通模式进行预测时，某些时间段可能会对整体空间相关性产生更大的影响，尤其是在高峰时段或特定的交通事件期间。DTW能够通过动态调整权重来涵盖这种影响，从而提高提取全局空间相关性的精度。我们采用DTW算法来计算$A_{te}$，其中$A_{te}$的元素表示为：

![image-20241030110010641](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301100709.png)

其中，$p$和$q$属于$\mathbb{R}^{N}$，==$N_{p}$表示与节点$p$具有最高$\theta\%$时间相似度的相邻节点集合==。 参数$\theta$用作控制$A_{te}$稀疏性的阈值（伯恩特和克利福德，1994年）。

> 为什么要用 0、1 表示，直接用DTW算法的结果表示不好吗？
>
> 因为在后续的GAT中需要一个 邻接矩阵 的输入
>
> 时间相似度 通过 DTW 算法计算出，然后
>
> - 计算每个相邻节点与节点 $p$ 的时间相似度后，根据这些相似度的大小进行排序，选择出相似度最高的 $\theta%$ 的节点。这个过程可以通过以下步骤完成：
>   1. 计算节点 $p$ 与每个相邻节点的相似度。
>   2. 将这些相似度值从高到低排序。
>   3. 选择最高的 $\theta%$ 相似度的节点作为集合 $N_{p}$。

> 有点懵
>
> DTW：动态时间规整算法
>
> + 按照距离最近的原则，构建两个序列元素之间的对应关系，评估两个序列的相似性
>
> ![image-20241031154104595](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410311541772.png)

#### 3.1.2 空间图

空间图提供了道路网络内空间连接的局部描绘，能够识别出直接相连且相互影响交通流量的相邻道路路段或节点。在道路连接邻接矩阵$A_{sp}$中，每个元素表示两条道路路段（记为$p$和$q$）之间是否存在直接连接。值为$1$表示存在直接连接，而值为$0$则表示不存在直接连接：

![image-20241030132226678](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301322739.png)

### 3.2 辅助信息

交通速度和天气是影响交通流量的重要辅助信息，它们之间可能存在相关性。 在暴雨期间，路面湿滑会导致交通速度下降，进而引发交通拥堵。

#### 3.2.1 交通速度

交通速度定义为$X_{s}=\{X_{s}^{1}, X_{s}^{2},\cdots, X_{s}^{T}\}\in R^{N\times C_{s}\times T}$，其中$X_{s}^{t}\in R^{N\times C_{s}}$表示在时刻$t$具有$N$个节点且特征维度为$C_{s}$的速度值。在本文中，我们将交通速度的特征维度设置为$1$。 我们使用了从加利福尼亚州交通运输部绩效测量系统（PeMS）收集的四个不同的交通速度数据集。这些数据集来源于旧金山三个地区和圣贝纳迪诺一个地区的高速公路。所有数据均每隔30秒由传感器收集一次，并每五分钟进行一次累加汇总。关于这些数据集的详细信息，请参阅表2。

#### 3.2.2 天气

天气被定义为$X^{w}=\{X^{w}_{1}, X^{w}_{2},\cdots, X^{w}_{T}\}\in R^{N\times C_{w}\times T}$，其中$X_{w}^{t}\in R^{N\times C_{w}}$表示在时刻$t$具有$N$个节点且特征维度为$C_{w}$的天气数据。在本文中，我们将天气数据的特征维度设置为6。 天气数据集覆盖的时间范围和区域与交通速度数据集相同。我们收集了五种类型的天气数据并对其进行了相应的预处理。数据集的详细信息在表1中列出。 由于数据集中存在一些离散特征，因此需要对它们进行编码。对于风向，我们将北方作为0度参考点，计算每个方向的弧度值，并使用三角函数来表示这些弧度值。例如，北方方向可以表示为$\sin(0)=0$，$\cos(0)=1$。至于天气类型，我们采用独热编码（one-hot encoding）进行表示。

![image-20241030133550689](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301335789.png)

> 风力、最大温度、最小温度、风向、天气类型 全部归属于 天气。
>
> 天气维度设置为6.
>
> 天气类型使用独热编码：一共多少种天气类型？
>
> > 在我的代码里天气类型有五六十种，使用独热编码维度太大

### 3.3 任务

与先前的研究类似，交通流量被定义为$X^{f}=\{X^{f}_{1}, X^{f}_{2},\cdots, X^{f}_{T}\}\in R^{N\times C\times T}$，其中$X^{f}_{t}\in R^{N\times C}$表示在时刻$t$具有$N$个节点且特征维度为$C$的观测值。我们设定$C = 1$来表示交通流量特征的维度。 我们的目标是训练一个函数$F$，该函数能够利用历史交通流量数据$X^{f}$、交通速度数据$X^{s}$、天气数据$X^{w}$以及两个图$A_{te}$和$A_{sp}$来预测接下来$H$步的序列，记为$Y^{(t + 1):(t + H)}\in R^{N\times H}$。因此，交通预测问题可以表述为：

![image-20241030134242440](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301342503.png)

## 四、方法论

![image-20241030135410500](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301354622.png)

图2展示了MIFGCN的整体框架，它由以下部分组成： 

(1) 一个基于注意力交互的门控线性单元（AIGLU）模块，用于捕捉时间依赖性； 

(2) 一个多源信息融合图生成器（MIFGG）模块，用于动态捕捉空间依赖性； 

(3) 一个扩散图卷积神经网络（GCN）模块。 

为了实现更好的长期预测，我们定义$i \in \{recent, daily, weekly\}$来表示不同时间粒度下两个连续时间戳之间的时间间隔。如果我们考虑以$h$分钟为每日采样频率，那么近期、每日和每周时间段的时间间隔将分别为1个时间步长、$(1440/h)$个时间步长和$(10080/h)$个时间步长。 对于每个时间间隔$i$，我们定义$T_i$为相应数据序列的长度，并从原始输入$X_f \in R^{N\times1\times T}$中提取多粒度数据$X_{f}^{i} \in R^{N\times1\times T_i}$。随后，每组多粒度数据分别输入到相同的并行结构中，以生成具有不同时间粒度的输出。然后这些输出在一个融合模块中进行整合。采样后的数据结构如图3所示。 鉴于这三种数据具有相同的结构，在本文的后续部分，我们仅以$i = recent$的情况为例来阐明模型构建的细节，并将$X_{f}^{recent} \in R^{N\times1\times T_i}$的表达式简化为$X_{f} \in R^{N\times1\times T_i}$。

### 4.1 基于注意力交互的 GLU

捕捉时间相关性在交通流量预测中起着至关重要的作用。门控线性单元（GLU）（多芬、范、奥利、格朗吉耶，2017年）不仅能有效缓解梯度弥散问题，还能保留非线性能力。凭借其门控机制，GLU能够实现信息的选择性学习和传递，这对于时间序列数据中的模式捕捉极为有利。 受SCINet（刘等人，2022年）的启发，我们设计了一个基于注意力的交互式学习模块，名为注意力交互模块（AI模块）。 ==AI模块结合了下采样、多次时间卷积以及基于注意力的交互式学习，以提取和建模不同尺度下的动态时间关系，涵盖短期和长期依赖关系==。如图2所示，输入数据$X_{f} \in R^{N\times1\times T_{i}}$在每个分支中通过各自的卷积核进行高维表示，分别记为$X_{1} \in R^{N\times F\times T_{i}}$和$X_{2} \in R^{N\times F\times T_{i}}$，其中$F$是大于1的整数。然后我们将AI模块嵌入到GLU的每个分支中，从而形成了基于注意力交互的门控线性单元（AIGLU）模块。

> 门控线性单元（GLU）

![image-20241030140808890](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301408009.png)

在如图4所示的AI模块中，我们以$X_{1}$为例来展示其处理过程。首先，我们根据奇数和偶数索引分别对$X_{1}$进行下采样，得到$X_{even} \in R^{N\times F\times\frac{T_{i}}{2}}$和$X_{odd} \in R^{N\times F\times\frac{T_{i}}{2}}$。如图5所示，这种下采样方法保留了原始序列中呈现的大部分时间相关性，为注意力交互操作提供了一个粗时间分辨率的视角。 随后，我们使用二维卷积核对粗时间分辨率下的$X_{even}$和$X_{odd}$分别进行特征提取，从而生成新的隐藏特征$\Gamma(X_{even}) \in R^{N\times F\times\frac{T_{i}}{2}}$和$\Phi(X_{odd}) \in R^{N\times F\times\frac{T_{i}}{2}}$。其中，$\Gamma$和$\Phi$表示卷积核。

![image-20241030141721358](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301417518.png)

> 下采样时间序列的可视化，其中每个子序列都能够保留原始序列的时间趋势：（a）表示原始数据，（b）对应于使用奇数索引生成的下采样数据，（c）对应于使用偶数索引生成的下采样数据。

假设奇数序列对应于由时间戳1、3、5索引的信息，偶数序列对应于由时间戳2、4、6索引的信息，像求和或乘法这样的基本交互操作可用于提取这两个序列之间的交互作用，这与SCINet所采用的方法类似。然而，这种方法仅限于捕捉相邻索引之间的交互，比如1和2、3和4以及5和6之间的交互。它无法捕捉长期特征，包括索引1和6之间的交互。 由于在不同时间戳下，路网中节点之间的关联分布不均匀，使用简单的交互方式会限制捕捉非相邻时间戳间的能力，因此可能无法胜任。例如，十字路口红灯期间的交通模式不仅与下一个时间戳相关，而且与下一次红灯期间的交通模式相似。 为了解决这一局限性，我们提出了一种自注意力机制来有效地对子序列内的交互关系进行建模。 公式如下：

![image-20241030143012873](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301430954.png)

![image-20241030143024152](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301430228.png)

其中，$X_{even-upd} \in R^{N\times F\times\frac{T_{i}}{2}}$和$X_{odd-upd} \in R^{N\times F\times\frac{T_{i}}{2}}$是注意力交互（Att-interactive）操作的输出，$\odot$和$Softmax$分别表示哈达玛积（Hadamard product）和Softmax函数。这个过程可以被看作是对$X_{even}$和$X_{odd}$进行的一种自注意力加权池化操作。通过对这两个序列的信息进行聚合，可以获得丰富的交互特征。自注意力机制会自动学习不同时间戳下其他节点的影响，从而增强对时间依赖性的感知能力。 为了提取更深入的信息，我们又进行了一轮注意力交互操作：

![image-20241030144124500](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301441602.png)

其中，$X_{even}' \in R^{N\times F\times\frac{T_{i}}{2}}$和$X_{odd}' \in R^{N\times F\times\frac{T_{i}}{2}}$是注意力交互（Att-interactive）操作的最终输出，$\epsilon$和$\rho$表示卷积核。 然后我们将$X_{even}'$和$X_{odd}'$拼接起来创建$X' \in R^{N\times F\times T_{i}}$作为AI模块（AI Block）的输出。在$X_{1}$所在的分支中，AI模块的输出经过Sigmoid函数激活，并与$X_{2}$所在分支的AI模块输出进行逐元素相乘，形成一个完整的基于注意力交互的门控线性单元（AIGLU）结构。这个过程表述如下：

![image-20241030144315155](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301443230.png)

其中，$X^{t} \in R^{N\times F\times T_{i}}$是基于注意力交互的门控线性单元（AIGLU）的输出，$\sigma$表示Sigmoid函数，$\odot$表示哈达玛积（Hadamard product）。

> 注意力交互模块：
>
> 输入：$X_{f} \in R^{N\times1\times T_{i}}$
>
> 输出：$X^{t} \in R^{N\times F\times T_{i}}$

### 4.2 多源信息融合图生成器

![image-20241030152631102](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301526278.png)

道路网络中的交通流量呈现出动态的时间变化，并受到多种因素的影响，包括交通特性、天气状况以及类似区域等。为了全面捕捉这些影响，我们精心设计了一个动态图，它整合了多种类型的信息以对道路网络的全局空间依赖性进行建模，如图6所示。多源信息融合图生成器（MIFGG）的输入包括原始交通流量数据$X^{f} \in R^{N\times1\times T_{i}}$、原始交通速度数据$X^{s} \in R^{N\times1\times T_{i}}$、天气数据$X^{w} \in R^{N\times6\times T_{i}}$、==动态时间规整（DTW）邻接矩阵$A_{te}$==以及道路连通性邻接矩阵$A_{sp}$。 为了使模型能够根据实时环境条件动态调节局部和全局空间依赖性，我们将$X_{s}$和$X_{w}$整合到一个动态门控值$\gamma$中。 这种设计模拟了辅助信息对交通流量的影响。首先，我们采用==主成分分析（PCA）来融合天气特征==，以便提取隐藏的天气参数。这种方法通过捕捉最重要的特征同时消除冗余和相关信息来降低模型的复杂度。该过程可定义如下：

![image-20241030151744405](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301517482.png)

其中，$X^{pca} \in R^{N\times1\times T_{i}}$是天气序列的主成分表示。

> PCA：主成分分析
>
> PCA是一种常用的降维方法，主要用于数据的简化、去噪和可视化。PCA 通过将数据从原始高维空间映射到低维空间，从而捕捉数据中最重要的特征。

然后我们使用两个可学习的矩阵$E_{1}$、$E_{2} \in R^{N\times\mu}$来生成一个自适应矩阵$A_{adt} \in R^{N\times N}$（白等人，2020年）。

![image-20241030154947779](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410301549860.png)

每种类型信息的影响在不同的时间戳下会有所不同。为了解决这个问题，我们设计了一个基于注意力的信息融合层，其由以下公式表示：

![image-20241031101119702](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410311011813.png)

其中，$\mathcal{A}$是注意力权重，$W_{1}$、$W_{2}$和$W_{3}$表示可学习的参数，$*$是二维卷积操作，$\parallel$表示拼接操作，$X_{fus}$是融合后的序列。并且门控值 $\gamma$ 定义如下：

![image-20241031103828196](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410311038298.png)

其中，$\sigma$是Sigmoid函数，$W_{a}$表示一 个可训练的参数。$A_{adt}$能够动态地适应$X_{fus}$对道路网络的影响，并在$\gamma$中反映这种适应性，以调节潜在因素与实际交通流量之间的信息流。

> multi-head Graph Attention Mechanism (GAT)：多头图注意力机制
>
> 输入：$X \in \mathbb{R}^{n \times F}$，这里 $n$ 体现了图中节点的数量，$F$ 则是每个节点自身特征向量的维度，也就是描述每个节点的特征数量。 
>
> 输出：$Y \in \mathbb{R}^{n \times F'}$，这里 $n$ 还是节点数量不变，$F'$ 是经过特征变换后每个节点新的特征维度，它可以和输入的 $F$ 相同也可以不同，取决于具体的任务需求和模型设计。

接下来，我们==利用多头图注意力机制（GAT）来处理图结构，探索潜在的全局空间依赖性==。GAT能够处理不同时间戳下的图，学习时间序列中节点的动态特征。通过对节点自适应地分配权重，GAT通过捕捉节点间的特征交互来增强对复杂空间关系的建模。 考虑$X_{f}=(x_{1}, x_{2},\cdots, x_{N})\in R^{N\times\omega}$，其中$x_{i}\in R^{1\times\omega}$表示节点 $i$ 的交通流量，节点更新后的特征$a_{ij}$定义如下：

![image-20241031104255327](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410311042403.png)

其中，$\mathbf{a}^{\top} \in R^{1\times 2\psi}$是一个注意力权重向量，$\parallel$表示拼接操作，$\mathbf{W}$表示可学习参数。然后我们通过以下方式计算归一化的注意力系数$\alpha_{ij}$：

![image-20241031104408961](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410311044036.png)

其中，$\mathcal{N}_{i}$是节点 $i$ 的一阶邻居。这使得模型能够自适应地学习不同节点之间关系的强度，在信息聚合过程中更有效地考虑全局图结构，而不是仅仅依赖局部邻居信息。在一个具有 $k$ 个头的图注意力机制（GAT）中聚合节点特征的过程可表示为：

![image-20241031104518772](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410311045866.png)

其中，$x_{i}' \in R^{1\times\psi}$表示节点 $i$ 的更新表示，$\sigma$ 表示Sigmoid函数，$W_{j} \in R^{\psi\times\omega}$ 是一个可学习的参数。

对于$A_{te}$和$A_{sp}$两者而言，图注意力机制（GAT）的处理方法是相同的。 因此，我们分别从图注意力机制（GAT）中获得输出 $X_{te} \in R^{N\times\psi}$ 和 $X_{sp} \in R^{N\times\psi}$ ，如下所示：

![image-20241031104736663](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410311047726.png)

> $A_{te}$ 在哪用了？
>
> 在 GAT 中需要一个邻接矩阵的输入来描述，节点间的关系。用于得到节点的一阶邻居

$X_{te}$和$X_{sp}$各自包含有关全局和局部空间相关性的隐藏信息。我们采用一种门控机制来自适应地学习信息流的动态变化：

![image-20241031104834563](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410311048657.png)

其中，$\hat{\mathbf{X}} \in R^{N\times\psi}$表示融合信息流，$\varphi(\cdot)$表示不同的激活函数。为了挖掘深层次的信息，我们堆叠了第 $l$ 层（在本研究中 $l = 4$ ）的多源信息融合图生成器（MIFGG）层，每层都将上一层的输出作为输入。多源信息融合图生成器（MIFGG）的最终输出是一个通过多层感知机（MLP）获得的动态融合图 $\mathbf{A}_{fus} \in R^{N\times N}$ 。这种方法使得$\mathbf{A}_{fus}$ 不仅能够动态地识别全局模式，还能捕捉到来自辅助信息的潜在影响。

扩散图卷积（DGCN）因其考虑了节点间的信息传播而受到关注，这有利于在信息传播过程中对节点间的连接权重进行动态调整。因此，我们利用DGCN来提取交通流量的空间相关性，充分发挥其全局和动态特性。其公式定义如下：

![image-20241031105444675](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410311054738.png)

![image-20241031105506092](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202410311055291.png)

其中，$Y_{r} \in R^{N\times F\times T_{i}}$是扩散图卷积（DGCN）在“近期”粒度下的输出，$W_{o} \in R^{N\times N}$ 和 $W_{e} \in R^{N\times N}$ 是可学习的参数。 三种时间粒度的数据会产生三种不同的输出。我们将它们拼接起来，并通过一个多层感知机（MLP）获得融合后的预测结果。训练多源信息融合图卷积网络（MIFGCN）的伪代码在算法1中给出。



## 五、实验

在本节中，我们在几个数据集上评估多源信息融合图卷积网络（MIFGCN）的性能，总结如下以回答以下问题：

+ RQ1：多源信息融合图卷积网络（MIFGCN）的性能与其他基准方法相比如何？
+ RQ2：模型中每个设计的组件提供了哪些优势？
+ RQ3：不同的超参数设置如何影响模型的性能？
+ RQ4：模型的短期和长期预测能力如何？

### 5.1 数据集

在本文中，我们额外纳入交通速度和天气信息来预测交通流量。我们使用由加州运输局绩效测量系统（PeMS）收集的四个公共交通流量数据集来评估模型的性能。所有数据均来自加利福尼亚州的高速公路传感器，以30秒为间隔采集，并每5分钟累计一次。因此，每个节点每天包含288个时间步长。根据实际需求，我们将数据集分为两组：（1）对于PeMS04和PeMS08数据集，利用完整的多源信息来辅助预测交通流量。（2）对于PeMS03和PeMS07数据集，在预测中不包括交通速度数据。这是因为这些数据集包含大量节点和较长的时间跨度。 表2展示了数据集的详细信息。

![image-20241103142746754](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202411031427911.png)

### 5.2 基线模型



### 5.3 实验设置

我们将数据集按照6 : 2 : 2的比例划分为训练集、验证集和测试集。为了标准化，所有数据都使用Z - 分数归一化进行归一化处理。我们的目标是根据一小时的历史数据预测接下来连续12个时间步长的交通流量。 实验在一台配备NVIDIA GeForce RTX 3090 Ti GPU的Linux服务器上进行，使用PyTorch框架。 卷积通道数$F$、动态时间规整（DTW）矩阵阈值 $\theta$ 和多源信息融合图生成器（MIFGG）的层数 $l$ 这几个超参数分别设置为15%、16和4。采用平均绝对误差（MAE）损失函数来计算误差，并使用Ranger优化器进行优化。 初始学习率设置为0.001，批量大小为64。 使用三种类型的指标进行评估：均方根误差（RMSE）、平均绝对误差（MAE）和平均绝对百分比误差（MAPE）。



### 5.4 比较与结果分析（RQ1）

表3展示了我们的模型与各类基准模型之间的比较结果。我们可以得出以下四个结论： 

（1）我们的多源信息融合图卷积神经网络（MIFGCN）在三项指标上展现出了显著的优势。特别是，与PeMS08数据集上表现第二好的方法相比，MIFGCN在平均绝对误差（MAE）、均方根误差（RMSE）和平均绝对百分比误差（MAPE）方面的平均提升分别为10.29%、13.49%和6.03%。这表明构建一个融合辅助信息的动态图以捕捉隐藏的空间拓扑结构是有效的。此外，由于数据量庞大，在PeMS07数据集里仅将“近期”（这里原文的“ 𝑤 𝑟𝑒𝑐𝑒𝑛𝑡”疑似拼写有误，推测应为“recent”）作为辅助信息输入，这间接导致了其性能优势不太突出。 

（2）深度神经网络模型明显优于经典模型。同时，考虑图结构的时空方法能有效地捕捉道路网络的空间特征，从而提高了预测精度。 

（3）自适应图卷积循环神经网络（AGCRN）通过采用自适应图取得了令人满意的性能。然而，它忽视了辅助信息对图结构的潜在影响。多尺度时空图卷积神经网络（TRes2GCN）专注于多尺度时空信息，并且在PeMS08数据集的各类基准模型中表现最佳。 

（4）我们提出的MIFGCN通过构建一个融合多源信息的动态图来全面提取空间特征，从而取得了最优结果。此外，我们设计了一种利用注意力交互的结构，以在粗时间分辨率下探索时间相关性，进而提高了长期预测精度。 我们绘制了六个模型（扩散卷积循环神经网络（DCRNN）、时空图卷积神经网络（ASTGCN）、门控波网络（GWN）、时空同步图卷积神经网络（STSGCN）、时空常微分方程神经网络（STGODE）和MIFGCN）在两个数据集上的多步预测结果，如图7和图8所示。在整个预测范围内，与其他模型相比，MIFGCN始终呈现出最小的预测误差。而且，随着预测范围的扩大，MIFGCN的精度优势更加明显，突显了其在长期预测方面的优势。

![image-20241229204811605](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202412292048100.png)

我们绘制了六个模型（DCRNN、ASTGCN、GWN、STSGCN、STGODE和MIFGCN）在两个数据集上的多步预测结果，如图7和图8所示。在整个预测时段内，与其他模型相比，MIFGCN始终展现出最小的预测误差。此外，随着预测时段的延长，MIFGCN的准确性愈发显著，凸显了其在长期预测中的优势。 

![image-20241229204928630](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202412292049063.png)

### 5.5 消融实验（RQ2）

为了验证MIFGCN各组件的有效性，我们设计了四个变体进行消融实验： 

- 无自注意力机制（w/o self - attention）：此变体去除了AI模块中的自注意力机制。 
- 无多源信息（w/o multi - source information）：该变体去掉了MIFGG层中的多源信息（天气和速度）。 
- 无动态融合图（w/o dynamic fusion graph）：用静态图替代动态融合图。 
- 无拼接操作（w/o concatenation）：在融合过程中，用可学习的加权求和操作替代拼接操作。 

表4中的实验结果表明，MIFGCN在两个数据集的所有指标上都表现出色。AI模块中的自注意力机制解决了时间序列中时间相关性分布不均的问题，从而改进了交互方式。辅助信息的融入有助于对道路网络潜在影响因素进行动态图建模，提高了预测精度。利用动态图使MIFGCN能够学习到真实拓扑结构中随时间演变的独特节点相关性，提供了静态图无法提供的空间信息。有趣的是，鉴于不同信息片段之间缺乏相关性，多粒度时间信息融合方法的选择对性能有着深远影响。只有通过恰当的组合，才能有效地提取所需的时空特征。 

![image-20241230132010651](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202412301320860.png)

### 5.6 参数敏感性（RQ3）

在本文中，我们选取卷积通道数𝐹、动态时间规整（DTW）矩阵阈值𝜃 以及 MIFGG 的层数𝑙作为超参数，利用 PeMS08 数据集研究它们对模型性能的影响，如图 9 所示。

![image-20241230132550164](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202412301325434.png)

超参数𝐹决定了映射到高维空间的原始数据维度，当𝐹设置为16时，模型性能达到最优。这一选择归因于我们模型的复杂性以及数据集的庞大规模。 卷积维度过高可能会导致过拟合，并显著增加计算成本。 超参数𝜃通过确定每个时间序列与其最强相邻节点之间的连接数量，来控制动态时间规整（DTW）图的稀疏性。将阈值设置得过高可能会引入不必要的噪声，而设置得过低则可能无法有效地对全局空间相关性进行建模。因此，𝜃的最优选择设定为15%。 超参数𝑙决定了有效捕捉多源信息之间动态关系的能力。𝑙值过小可能难以学习复杂特征，而𝑙值过大则会增加计算成本并导致过拟合。实验结果表明，将𝑙设置为4时性能最佳。 

### 5.7 预测准确率的可视化（RQ4）

为评估MIFGCN的短期和长期预测能力，我们从PeMS08数据集中选取一条道路，并直观呈现2016年8月29日全天的详细交通流量。我们将MIFGCN与三个基线模型（STGODE、STSGCN、GWN）进行对比。如图10所示，15分钟的预测结果用于评估短期预测能力，60分钟的预测结果则用于评估长期预测能力。图中横轴表示时间，纵轴表示交通流量。 

![image-20241229205351819](https://raw.githubusercontent.com/Quinlan7/pic_cloud/main/img/202412292053043.png)

图10显示，所有模型的短期预测准确率均高于相应的长期预测准确率。这一现象归因于误差随时间累积，时间间隔越长，引入的不确定性越大。值得注意的是，与其他模型相比，无论是短期还是长期预测，MIFGCN（红线）的整体预测表现与实际值（蓝线）最为接近。由注意力交互门控线性单元（AIGLU）实现的多尺度时间相关性，使MIFGCN能够有效地对时间趋势进行建模。与其他基线模型相比，MIFGCN在交通流量波动时刻展现出卓越的预测能力，同时也具有出色的准确性。这得益于该模型对多源信息与交通流量之间隐含相关性的熟练挖掘。我们还放大了交通流量预测的关键部分，如午间低谷和晚间高峰时段。 可以观察到，MIFGCN在大多数时间步上都与实际值紧密贴合，凸显了其在时空交通流预测方面的优势。 

## 六、总结和未来工作

本文提出了一种新颖的用于交通流预测的时空框架MIFGCN。具体而言，我们构建了一个动态融合图来捕捉隐含的时空相关性，有效地对交通流变化的时间趋势进行建模。这个动态图整合了道路网络内的多源信息，包括天气和交通速度。此外，我们设计了一个基于注意力机制的交互式时间模块，以提取不同时间分辨率下的时间特征。通过时空模块的整合，我们所提出的MIFGCN模型展现出强大的鲁棒性和长期预测能力。 本研究的主要发现如下：（1）基于注意力机制的动态融合图模块，整合了交通速度和天气信息，模拟了道路网络中潜在辅助信息导致的显著交通波动。动态图结合了各种预定义图来探索全局空间相关性，有效地挖掘了节点之间随时间变化的连接。（2）AIGLU在粗粒度分辨率下探索复杂的相互作用，有助于对子序列之间不均匀的时空依赖关系进行建模，并实现更好的长期预测。（3）利用不同粒度的交通数据能够提取多尺度特征，有助于更好地理解交通流的趋势和周期性，这与先前的研究结果一致。 总而言之，本文提出了一种新颖且有效的交通流预测模型。尽管如此，在选择合适的多源信息方面仍存在固有局限性。鉴于影响道路网络中交通流的因素众多，辨别最相关的信息至关重要。后续的研究工作将集中于分析不同数据源之间的非线性相关性，探索影响交通流的各因素的最优组合，以提高预测精度。 

