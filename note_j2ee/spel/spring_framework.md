# SpEL

*起因：在学习 Spring Security 的过程中，发现使用权限注解 @PreAuthorize 时，参数表达式使用的是 SpEL 就想多了解一些*

## 第一章 介绍

Spring表达式语言（简称SpEl）是一个支持查询和操作**==运行时对象==**导航图功能的强大的表达式语言. 它的语法类似于传统EL，但提供额外的功能，最出色的就是函数调用和简单字符串的模板函数。

尽管有其他可选的 Java 表达式语言，如 OGNL, MVEL,JBoss EL 等等，但 Spel 创建的初衷是了给 Spring 社区提供一种简单而高效的表达式语言，一种可贯穿整个 Spring 产品组的语言。这种语言的特性应基于 Spring 产品的需求而设计。

虽然SpEL引擎作为Spring 组合里的表达式解析的基础 ，但它不直接依赖于Spring,可独立使用。为了整合，许多在本章使用SpEL例子就好像它是一个独立的表达式语言。这就需要创建一些引导 如解析器这样的基础构造类。大多数Spring用户将不再需要处理这些基础构建，而是仅将作者表达的字符串进行解析。一个传统的使用例子是集成SpEL去创建XML或者定义Bean的注解,可以选择这里看到 [表达式支持定义bean.](http://itmyhome.com/spring/expressions.html#expressions-beandef)

本章讲介绍SpEL的API，其语言语法的特点。在几个地方，Inventor和Inventor’s Society 类被用做表达式解析的目标对象 。 这些类声明和使用数据一直贯穿本章结尾。



> **大概过了一遍 SpEL 的教程，没发现在实际项目中具体有什么应用！**
>
> **感觉最大的用处可能就是 基于XML的配置 和 基于注解的配置了（@Value）！**
>
> **但是又查了一下发现我在 @Value 中使用的都是 占位符语法 而并不是 SpEL语法 可能是目前涉及到的项目还比较简单。**





+ springboot中的@value注解中的 # 和 $ 有什么区别

> 在Spring Boot中，`@Value`注解用于将值注入到Spring组件中。它支持两种不同的表达式语法：`${...}`和`#{...}`。这两种语法具有不同的解析方式和用途。
>
> 1. `${...}`语法（占位符语法）：
>    `${...}`语法用于引用配置文件中的属性值，类似于传统的属性占位符。它在运行时被解析并替换为配置文件中相应的属性值。这种语法主要用于读取配置文件中的属性值。
>
>    示例：
>    ```java
>    @Value("${app.name}")
>    private String appName;
>    ```
>
>    在这个示例中，`${app.name}`会被替换为配置文件中`app.name`属性的值。
>
> 2. `#{...}`语法（SpEL语法）：
>    `#{...}`语法用于使用Spring表达式语言（SpEL）进行更复杂的表达式求值。它允许进行逻辑计算、方法调用、访问对象属性等更高级的操作。
>
>    示例：
>    ```java
>    @Value("#{ systemProperties['user.name'] }")
>    private String username;
>    ```
>
>    在这个示例中，`#{ systemProperties['user.name'] }`使用SpEL语法获取系统属性中的`user.name`值。
>
> 总结来说，`${...}`语法是用于引用配置文件中的属性值，而`#{...}`语法是使用Spring表达式语言进行更复杂的表达式求值。具体使用哪种语法取决于你的需求，如果只需要读取配置文件中的属性值，使用`${...}`；如果需要更高级的表达式求值和操作，使用`#{...}`。





> **大概过了一遍 SpEL 教程，感觉一是晦涩难懂，二是不知道应用在什么场景。**
>
> **观察 Spring Security 中的对 SpEL 的应用，感觉可以在哪里用到这个语法，就在哪里学学就可以，集中学习感觉意义不大**



+ SpEL语法在实际项目中有哪些应用

> SpEL（Spring Expression Language）在实际项目中有广泛的应用。以下是一些常见的应用场景：
>
> 1. 注解配置：SpEL可以在注解中使用，例如`@Value`注解、`@PreAuthorize`注解、`@Scheduled`注解等。通过使用SpEL表达式，可以动态地配置属性值、权限控制规则、定时任务等。
>
> 2. XML配置文件：SpEL可以在XML配置文件中使用，用于配置Bean的属性值、条件判断、动态引用等。它使得配置文件更加灵活和可配置化。
>
> 3. 动态查询：SpEL可用于动态生成查询条件，特别是在Spring Data JPA或Spring Data MongoDB中。通过在查询方法中使用SpEL表达式，可以根据运行时的条件来构建查询语句，实现动态查询。
>
> 4. 条件判断：SpEL可用于条件判断，例如在`if`语句、循环中使用SpEL表达式来决定执行的逻辑。
>
> 5. 事件处理：SpEL可用于定义事件处理器的条件和动作。例如，可以在Spring框架的事件机制中使用SpEL来定义事件的触发条件和处理逻辑。
>
> 6. 安全控制：SpEL可用于Spring Security中的权限控制规则定义。通过使用SpEL表达式，可以基于业务逻辑和运行时的上下文来定义安全规则。
>
> 7. 配置文件占位符：SpEL可以在配置文件中作为占位符使用，用于动态配置属性值。通过在配置文件中使用`${...}`语法，可以引用其他属性或系统属性的值。
>
> 这只是SpEL的一些常见应用场景，实际上SpEL非常灵活，可以应用于各种需要动态计算和配置的场景。它提供了丰富的语法和功能，使得应用程序更具可配置性、可扩展性和动态性。















##### 参考

[**Spring 表达式语言 (SpEL)**](http://itmyhome.com/spring/expressions.html)

[玩转Spring中强大的spel表达式！](https://cloud.tencent.com/developer/article/1676200)