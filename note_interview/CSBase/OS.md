# 操作系统

[TOC]

## 一、基础

### 1.1 操作系统是什么

1. 操作系统是管理计算机硬件与软件资源的程序，是计算机的基石。 
2. 操作系统本质上是⼀个运行在计算机上的软件程序 ，用于管理计算机硬件和软件资源。 
3. 操作系统存在屏蔽了硬件层的复杂性。
4. 操作系统的内核（Kernel）是操作系统的核心部分，它负责系统的内存管理，硬件设备的管 理，文件系统的管理以及应用程序的管理。 内核是连接应用程序和硬件的桥梁，决定着系统的性能和稳定性。

### 1.2 系统调用

介绍系统调用之前，我们先来了解⼀下用户态和核心态。 根据进程访问资源的特点，我们可以把进程在系统上的运行分为两个级别： 

1. 用户态(user mode) : 用户态运行的进程可以直接读取用户程序的数据。 
2. 核心态(kernel mode)：可以简单的理解系统态运行的进程或程序几乎可以访问计算机的任何资源，不受限制。 

说了用户态和核心态之后，那么什么是系统调用呢？ 

系统调用（System Call）是操作系统提供给用户程序的一组接口，用于实现用户态程序对系统级资源的调用。



## 二、进程与线程

### 2.1 进程与线程

**进程**

进程是程序的一次执行过程，因此进程是动态的；进程是操作系统进行资源分配的基本单位，每个进程都有自己的独立内存空间。

**线程**

线程又叫做轻量级进程，是处理器任务调度和执行的基本单位。

线程只拥有一点在运行中必不可少的资源(如程序计数器，一组寄存器和栈)，但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。

**区别**

- 根本区别：进程是系统**资源分配**的基本单位，而线程是**处理器任务调度**和执行的基本单位。
- 内存分配：同一进程的线程共享本进程的地址空间和资源，而进程之间的地址空间和资源是相互独立的。
- 资源开销：每个进程都有独立的代码和数据空间，程序之间的切换会有较大的开销；线程可以看做轻量级的进程，同一进程的线程共享代码和数据空间，每个线程都有自己独立的运行栈和程序计数器，线程之间切换的开销小。

### 2.2 进程状态

⼀般把进程⼤致分为 5 种状态

+ 创建状态(new) ：进程正在被创建，尚未到就绪状态。 
+ 就绪状态(ready) ：进程已处于准备运行状态，即进程获得了除了处理器之外的⼀切所需资源， 一旦得到处理器资源(处理器分配的时间片)即可运行。 
+ 运行状态(running) ：进程正在处理器上上运行(单核 CPU 下任意时刻只有一个进程处于运行状态)。 
+ 阻塞状态(waiting) ：又称为等待状态，进程正在等待某一事件而暂停运行如等待某资源为可用 或等待 IO 操作完成。即使处理器空闲，该进程也不能运行。 
+ 结束状态(terminated) ：进程正在从系统中消失。可能是进程正常结束或其他原因中断退出运行。

### 2.3 进程的调度算法

我记得几种常见的调度算法

+ 先来先服务
+ 短作业优先
+ 优先级调度
+ 时间片轮转
+ 多级反馈队列调度算法：多级反馈队列调度算法的核心思想是通过多个队列来管理不同优先级的进程，并根据进程的行为（例如运行时间和等待时间）动态调整其优先级。不同的队列有不同的时间片（时间量），通常，较高优先级的队列具有较短的时间片，而较低优先级的队列具有较长的时间片。

### 2.4 进程间的通信方式

1. 管道
2. 信号：比如 kill -9 1050 就表示给PID为1050的进程发送 SIGKIL 信号。
3. 消息队列：消息队列就是保存在内核中的消息链表。
4. 共享内存
5. 信号量：可以用来控制多个进程对共享资源的访问。
6. Socket：与其他通信机制不同的是，它可用于不同机器间的进程通信。

### 2.5 线程间的同步

同步解决的多线程操作共享资源的问题，目的是不管线程之间的执行如何穿插，最 后的结果都是正确的。

临界区：我们把对共享资源访问的程序片段称为 临界区 ，我们希望这段代码是 互 斥 的，保证在某时刻只能被一个线程执行，也就是说一个线程在临界区执行时，其 它线程应该被阻止进入临界区。

临界区同步的一些实现方式：

1. **锁**

使用加锁操作和解锁操作可以解决并发线程/进程的互斥问题。 任何想进入临界区的线程，必须先执行加锁操作。若加锁操作顺利通过，则线程可进入临界区；在完成对临界资源的访问后再执行解锁操作，以释放该临界资源。 加锁和解锁锁住的是什么呢？可以是临界区对象，也可以只是一个简单的**互斥量** 。

比如 Java 中的 synchronized 关键词和各种 Lock 都是这种机制。

2. **信号量**

信号量是操作系统提供的一种协调共享资源访问的方法。

通常信号量表示资源的数量，对应的变量是⼀个整型变量。 通过 **P** 和 **V** 两个原子操作的系统调用函数来控制信号量。

### 2.6 死锁

在并发线程中，多个线程互相等待被别的线程所持有的临界区资源。

**四个必要条件**

1. 互斥条件：共享资源互斥访问；
2. 持有并等待：线程已经持有的资源 1，还在等待资源 2 ；
3. 不可剥夺：线程在自己使用完资源之前该资源不能被其他线程获取；
4. 循环等待链：多个线程获取资源的顺序构成了环形链；

**如何避免**

互斥条件不可破坏

一次性分配完所需资源。

剥夺已分配资源，造成饥饿，增加线程切换的带来的上下文切换的损耗。

资源有序分配



## 三、内存管理